import React, { useState } from 'react'; import { chat } from './lib/api'; import { extractChartBlocks } from './lib/charts'; import { inferEmotion } from './lib/emotion'; export default function App(){ const [msgs,setMsgs]=useState<{role:'user'|'assistant';content:string}[]>([]); const [input,setInput]=useState(''); const [emotion,setEmotion]=useState('neutral'); async function send(){ const next=[...msgs,{role:'user',content:input}]; setMsgs(next); setInput(''); const resp=await chat([{role:'system',content:'You are Yuehua, a friendly lunar persona.'},...next]); const content=resp.choices?.[0]?.message?.content??''; setMsgs([...next,{role:'assistant',content}]); setEmotion(inferEmotion(content)); try{ if('speechSynthesis' in window){ const u=new SpeechSynthesisUtterance(content); window.speechSynthesis.speak(u);} }catch{} } return (<div style={{maxWidth:820,margin:'40px auto',padding:16}}><h1>ðŸŒ™ Lunar Astral Agents</h1><p>Chat + Charts + (optional) Live2D avatar. Trading bot runs separately.</p><div style={{border:'1px solid #333',borderRadius:8,padding:12,minHeight:240}}>{msgs.map((m,i)=><Message key={i} role={m.role} text={m.content}/>)}</div><div style={{display:'flex',gap:8,marginTop:12}}><input value={input} onChange={e=>setInput(e.target.value)} placeholder='Say hiâ€¦' style={{flex:1,padding:10}}/><button onClick={send}>Send</button></div><p style={{opacity:.6,marginTop:8}}>Emotion: {emotion}</p></div>);} function Message({role,text}:{role:string;text:string}){ const blocks=extractChartBlocks(text); return (<div style={{margin:'8px 0'}}><b>{role}:</b> <span>{text}</span>{blocks.map((b,i)=>(<pre key={i} style={{background:'#111',color:'#9f9',padding:8,overflow:'auto'}}>{b.type.toUpperCase()}:
{b.code}</pre>))}</div>);}